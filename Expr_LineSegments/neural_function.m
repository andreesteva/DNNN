function [Y,Xf,Af] = neural_function(X,~,~)
%NEURAL_FUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 15-Oct-2014 20:50:11.
% 
% [Y] = neural_function(X,~,~) takes these arguments:
% 
%   X = 0xTS cell, 0 inputs over TS timsteps
% 
% and returns:
%   Y = 1xTS cell of 0 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Layer 1
  b1 = [1.3989892807174439948;1.3489348134972949378;-1.2942038972121456819;1.2505065279121660993;1.1722569821335953044;-1.116326242465393026;1.062871846794894326;-1.0064031510577353679;0.94629144134652432019;-0.88654957139047918524;0.84182354125254810207;-0.77475365622385050646;-0.71201089771804870754;-0.66028877796703355774;-0.59249017286786354042;0.53852054462285958714;-0.49172669761634596464;-0.42053562199367816588;-0.38644882437847000167;0.30589698135643200727;0.25728370242494508213;0.19653245222944090709;0.1308592932292795552;-0.091712150634402536675;-0.030056794392877683036;-0.024890203167358411485;0.084120502248985665195;-0.14045699835323330329;0.19423818603340209377;0.26779639748240374741;-0.31987515886137163346;0.36953339162329251755;-0.43282500488056391275;0.49598877117651252178;0.54628805054132412167;0.58657093308755092753;0.65798834146256945932;0.71248603632067442071;0.76593300304575062665;-0.83223599721983398947;-0.88243115859348308927;-0.94355348749335121727;-1.021776560341956186;-1.0591022510505128107;1.1215639013243732247;1.1767940391468107997;-1.2377934177087488443;-1.2957183179017537356;1.343769069796757476;1.4095287899732960035];
  
  % Layer 2
  b2 = [1.4468647610424323346;-1.1349666237288471571;-0.82103130989197825595;0.44948965790050288138;-0.17956214735993350495;0.17431162653915199812;0.46044816506849078896;0.79678206310360522036;1.1405497171160077219;1.4579481249912107366];
  LW2_1 = [-0.19016290955950673758 0.30583182263418051683 -0.0054838565276687633449 0.3457297085291045069 0.17538297575864778 -0.070080557224020192941 -0.30562300591659624649 -0.25049718957400129993 -0.072034582254625945108 0.035020743802370975228 0.28318306952706590041 -0.27585907429756040266 0.086857602472465031407 0.2882280545981848463 -0.34001684250840291668 0.1289208140757736043 -0.30313140567651264412 -0.010991732554583398887 0.25899556885714269949 -0.3421977036636263958 -0.041998954921801182061 -0.040762055902343406755 -0.14778499838805142508 0.29636500148035788138 -0.13994215933135142893 -0.074008353727786080345 -0.018026265481506282412 0.10199119819034034584 0.03543213213302823239 0.16687416569963178792 0.26289371904428515681 0.29553460213450399863 0.0071723285571603807159 0.22106612751494914004 -0.27524481721130439338 -0.18957385491031433777 -0.058364178714180710295 -0.063673417817442373723 -0.28919033396521087731 -0.050014653861874522334 0.34247249313529393167 0.30805708788906027706 -0.049588525337994952824 -0.32065613230419598434 -0.077730150154936950013 0.19736214761710704768 -0.077391685494875461782 0.22177012784276153856 0.29849865150184085039 0.30534131835242489528;0.0035053937146351599533 0.3118131864481513138 -0.15641486436351162426 0.31878683469245006066 -0.041620839580544598257 -0.041994523455234772369 -0.11576980136997096216 0.1929550431896148166 -0.23347941125096186021 0.2419570207887357105 0.15763165396514150496 0.17625021553082509396 0.31269974632266028802 0.28134420466591519849 0.32116310640202688775 0.29799217075532141719 -0.12144445238518465635 -0.14907832045285845934 -0.0959364088927354558 0.27933507937394130849 0.04361061486025101519 -0.2828035746328712019 0.31397825403679008316 0.18132769187541439293 0.047225505486327097604 -0.1282072312356818955 -0.076322008529202872706 0.25675855206246794848 0.23196528322574688774 0.097328635638299201838 -0.0825345223216640278 0.19163866181240238329 -0.26454949329675514491 0.24385652376947100639 -0.12919740239495108858 -0.31103199967569827855 0.2371217501150389706 -0.11615760339472513962 0.049612049076093740763 -0.26115437531992796716 0.05445926478339174065 0.11510788169406893644 -0.12470234122843419644 0.3176172759344989549 -0.18217017303460777966 0.30112504903377662613 -0.096582757103364072493 0.29079708162910350433 0.21487423961930468552 -0.27199879014893130202;0.32010343767444682239 -0.16366302082734976442 -0.31871375444528815546 0.17718093671716075854 -0.085216999269364476777 -0.10311162255285612199 -0.32111178493952241553 0.25414144653529707751 0.017164753657948370741 0.23400986940847959272 -0.052502825853761529717 0.088916583584742928115 -0.24188624290159321806 -0.22760276578603647057 0.22285203851748702775 -0.19501400729201176509 0.15972231392215244239 -0.2638984120506926434 -0.073193179919752965334 -0.085983366821370726951 -0.17762123890894204736 -0.21802752742917422268 -0.30099360884095438529 -0.11345529131202643225 -0.21627574160278029147 -0.27250939037045573965 -0.18827273358002419301 0.036910754028738224086 0.28143492330415298408 0.020906699949447854481 -0.08877182236869972376 -0.086048123560985137481 -0.0055809962550216092592 -0.044571715398671454822 -0.30577199601873461532 0.077024179265989936582 0.36054941576258237035 -0.35077607764568258242 0.082812707353071904337 -0.32641840695855101062 0.21058848017089529248 0.20650975424930517743 -0.12330141029416415155 0.2379869301021890482 0.02458775935287118436 -0.20036160257524546213 0.11573737475510550987 -0.30272559370996421357 0.12394911458647987768 -0.25975862474223976317;-0.1454688894151986156 0.25563793890647273921 0.29321603449926414431 -0.077293974492177161539 0.062785512975441354344 -0.12819055174254476159 -0.35968874981211962361 0.21826651005494002167 0.28456989641199303964 -0.12276867335100333234 -0.30927738202961463365 0.1265567935460961968 -0.32553896566999090956 0.040403157382708811129 -0.16113591842036975588 0.048225728341663776089 0.052381845234814733425 -0.18973665676704651317 0.39787027863703144925 -0.052639808636557837429 -0.30908383972787378813 -0.24399031593174849708 0.13282609443638804247 -0.33147341246720368746 0.015719797792640096551 -0.05974965974071810848 0.35568102364499754042 0.15584068444283316612 0.0731668131985771103 0.015413089972383872683 0.30436414400801897751 -0.20261827743297494697 0.30905446147949811042 0.12444416968795740663 0.13992947592375612476 0.099295499165308637179 -0.294294617908036793 0.11310602206474189291 0.009483146208757568113 -0.071217714883085314614 0.039012843754549636488 -0.25526116222653966181 0.22026177143653172252 -0.21659335311055524786 -0.14665987242592554152 -0.36030912096675099532 0.14436854502171969639 0.3436054743359291952 0.17613170330538274744 0.078297154079750602707;0.088514942109025648853 -0.26903412263615400501 0.29026245803064870676 -0.48320772573940845573 0.12814653296766334578 -0.043087802533047489528 -0.37028549285534706481 0.24010653495080444553 -0.28651210076095762203 0.095624702536542441345 -0.18936266537688792311 0.32760325996947364802 0.12925177400741907907 -0.24074389083596348105 0.075664079635464800977 0.18552596062840007174 0.34395394363980769104 -0.23776904669710088869 0.3944290899493689273 0.38402172614364138425 -0.065904785431287069009 0.1057034690369417218 0.29059953907921021177 0.05174816465935115628 -0.22094240953471316891 -0.15269310638270400249 0.16180565699785398603 -0.22749354993775225409 0.31937932804535434927 -0.44950790539805474122 0.32736975828024561519 0.013884439765053659468 -0.018853092334227126992 0.15232561151368012586 -0.36684906188845955999 0.24052451628837209774 0.10293186221016101256 -0.11100413090322218401 0.33701954880234447076 0.10631786374680937679 -0.26546736017623645543 0.0071159303199555944824 0.15972882929430914922 0.27115351779523105824 -0.32066975678189241217 -0.2117075771834702469 -0.066409341259570070504 0.22099745162610717752 -0.0077676420229847512045 -0.19311045811001240069;0.16584124063430247253 0.20629337784843718162 -0.29265750184979033577 -0.30221772454859680002 -0.24062735438404309063 -0.34003726183500654345 0.081021843998617615323 0.33705810429739913037 -0.17499305835454284641 -0.13023637451057304415 -0.19484449345130572251 -0.049147720433253619388 -0.26663229987893083406 -0.12082519391553483978 -0.0025333215439405313424 0.32494106700788200071 0.11568301507687889229 -0.061684382400156917425 0.21632471368687378188 0.31767370778991843583 0.066608671006255518177 0.17869096863513511675 0.16405038692824477908 0.29247569539125345406 0.14296924283173498282 0.099993179746398611063 -0.26303080212822316231 0.32233111151099896885 0.16562968713668543841 -0.12011043305784260826 0.28564420266019024952 -0.061390498756574603256 0.30695512286608894748 0.20929740263537113809 0.20727018211066688957 -0.29898395219626355823 -0.054689630048253813632 -0.18391553732044801928 0.0033072069954732346946 0.018307884976706823021 -0.093185366652891218897 -0.19165123831529493059 -0.18607780951813066017 0.12484591161787103597 -0.30226961120235024127 0.33644265200360362611 -0.029863684517306195859 0.15352119474759359785 0.21554792677862105732 0.18363686369002871213;0.26218970405105701538 -0.34521503135152131758 0.22558472502115867186 -0.34894002268533991229 0.23278595073249452874 -0.069655417655575022073 0.033326486915963918212 -0.12886685982452608656 0.27507370890123455931 -0.013258915961285699936 -0.26743688159636963553 -0.19866725444899996367 -0.16969626761474143617 0.087297726102042783047 -0.055787532776376096144 0.17299141827244496339 -0.016148029946787333805 -0.26882560314229592136 0.17366364196391295693 0.25408035667185341344 0.28956696971351975067 0.15186842526038216161 0.35270135373423255887 0.17547058463488315883 0.22933733138093279069 -0.34771345175181600506 0.20122962030900801156 -0.3737607292399268144 0.1914532621978797533 -0.19213806847178321879 -0.19342986727552330395 0.32792620719066378765 -0.15802240710027745663 -0.42232552770622300287 -0.10848366767767336771 0.41661314506794983048 0.095005883850023967185 0.28046896343783433991 0.18875036947606227411 -0.28065492042187345501 -0.12159478682818342099 -0.083798801524754579217 0.39244730106777592216 -0.26515790694277674433 -0.2031325826147640512 0.27180959114156599821 0.17807089404337705929 -0.13835573606877391017 0.10050681601774356932 -0.18187659016223275965;0.25192170183004153339 -0.33874106602112469266 0.21235735632829477737 -0.025232856094919715872 0.17947856908284462452 0.019862791368586089902 -0.12177292412064281979 -0.18857929268461312566 -0.32053790127156783774 0.00023890634568028262233 0.21305665359109776658 -0.23016264309379105835 -0.29814385412407301557 -0.16724620442730606107 -0.30979633013979784861 -0.33195126796841700756 0.31119296761210840652 -0.097757096690212055834 -0.31311992359932111496 0.0058698784857836600742 0.052731113156005531006 0.12607913382411539693 -0.027226703314830215386 0.25813859173118125501 -0.23467793483423249334 -0.32712418608616367077 0.2375143303556005725 -0.28294522742153438433 0.15419290615052475002 0.24947609957550592741 -0.23082931719619931288 -0.16178874394501988054 0.31482214169328026632 -0.25131956977221125982 0.15226319463962981193 0.091666198160873180178 0.063649928400237532067 0.15966820452499674854 0.14238157345831664591 0.30433739717445335016 0.17302869657966130079 0.29093277535917894117 -0.19954878796135083752 0.16605137160167529609 0.12663985477318770445 0.067079431527803462521 -0.098478160413196264011 0.133267070893057199 0.2563551346304832057 -0.072874546454302441267;0.25974030403056341809 -0.13042642235683146734 0.30004888788574007874 -0.30805945346007790331 -0.31084638547194065605 0.21989680318045082275 0.28353322589171786605 -0.0050848162872021091321 0.13425730164248536602 -0.22872922553935615131 0.025226665313609831359 -0.24393482801430974027 -0.28053026876302966652 -0.092473578250111279631 -0.11681384036189566833 -0.15006637361707159117 -0.17864542075455402959 0.00026442559904213614385 -0.075911185350302834429 0.0055535568153166313399 -0.17145292620922467086 0.031507955684483432424 -0.14823361836793449986 0.1390232630124120794 0.12893462905769556559 0.27808145368981107559 -0.33116874027401954628 0.042946882353669800503 0.19701693447003948423 0.31016293444285647496 0.24308459506917054482 -0.16731490568689008636 0.008162318793845640269 0.24398070506232619192 0.031026257287952420383 0.20023364042212615788 -0.24132624125613985622 -0.081527302004446758343 0.33745756921632591441 -0.33128610937791680424 -0.1988681913139992985 0.065744588065923870168 -0.041722400804298800936 -0.21780233753925054563 0.23325055772530089993 0.33233619179830459212 -0.23875002314103130341 -0.27283711925146397759 -0.29572338789064672726 -0.01463334141190616132;0.25374731577371445468 -0.20155057736010409397 -0.2345263073389481645 0.086767643421773357759 0.21669839746456340257 -0.18973123894667712208 -0.3807157420915164292 0.15112670081774334796 -0.24655292127115011058 -0.0073610241090290174509 -0.28363182072344927942 -0.28026888517170572834 -0.085619235502511201186 0.23453738255002154478 -0.098296978771533677355 -0.28510565750448657596 -0.14107079701667163407 0.24860682754821158968 -0.028689070121266615349 0.30996944939408849207 0.10188384097065777967 0.081229264396937020387 -0.0069331132879463233318 -0.31081135819873378923 0.13573360708722231882 -0.14747450009411958161 0.29381447895991319452 -0.35249906651311641026 0.23576180980527033926 -0.24229775982531115419 -0.050306338351183199631 0.17411981939154425048 0.29518566743544061293 -0.34218058499436271314 -0.4450884504599044722 0.094155846792758374209 0.16127341997849400923 -0.023748953991081327847 0.0082595230589073108385 0.10705149706486964678 -0.219170817424176545 -0.25252003120975713424 -0.032223448050449708668 -0.086992014661517125251 0.19157226582551922789 0.056386641854271023211 -0.11348676462042876778 0.35847536482588349127 0.12789915958188430301 -0.35856066966196387114];
  
  % Layer 3
  b3 = [0.55425379292608401016;0.83971678254877468728;0.033436066195768991693];
  LW3_2 = [0.32453860890459423905 -0.39231183926813095741 0.1330426156984731989 1.0759054419202833675 0.57960465563136509548 -0.29672666824862381496 0.82930276315970086198 0.87959180503110490079 1.005481874855221891 -0.28726751478027617859;0.11816269349758971863 -0.9468975338084505422 0.56514479106686121845 0.34408003010057192084 0.96882091720677221414 -0.31550811407728274194 -0.49460826990489081822 0.98611110342874330748 0.59156777433200069538 0.51025668248401678806;0.94273291064087594293 0.11233786361206854476 0.2491536131073767979 0.035947270486163425407 -1.0990540598747091661 0.41063829179222266497 -0.73772069151663244302 -0.74799381842753209781 0.20152503268541621662 -1.1321583928532752417];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = [2;2;2];
  y1_step1_xoffset = [0;0;0];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q));
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = softmax_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(0,0);
  Af = cell(3,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
